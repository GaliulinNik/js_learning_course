<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Chart.js</h1>
    <p><a href="https://www.chartjs.org/docs/latest/">Chart.js</a></p>

    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const ctx = document.getElementById("myChart");
      const place_name = "Омск"; //тут задаем город
      const API_KEY_YANDEX = "85eaff1b-ef9e-4c11-89bc-ca01d1ae43de";
      const API_URL_GEO_DATA = `https://geocode-maps.yandex.ru/1.x/?apikey=${API_KEY_YANDEX}&geocode=${place_name}&format=json`;

      fetch(API_URL_GEO_DATA)
        .then((resp) => resp.json())
        .then(function (data) {
          let strCoordinates =
            data.response.GeoObjectCollection.featureMember[0].GeoObject.Point
              .pos; //получили координаты нашего города
          //console.log(strCoordinates);
          let coordinates = strCoordinates.split(" "); //разбили строку на массив строк используя разделитель пробел
          const API_OPEN_METEO = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${coordinates[0]}&longitude=${coordinates[1]}&hourly=pm10,pm2_5`;
          fetch(API_OPEN_METEO)
            .then((resp) => resp.json())
            .then(function (data) {
              //время : количество частиц pm10 : количество частиц pm2_5
              // for (let i = 0; i < data.hourly.time.length; i++) {
              //   p.innerHTML = `Дата и время: ${data.hourly.time[i]} <br> pm10: ${data.hourly.pm10[i]} <br> pm2_5: ${data.hourly.pm2_5[i]}`;
              // }
              new Chart(ctx, {
                type: "bar",
                data: {
                  labels: data.hourly.time,
                  datasets: [
                    {
                      label: "pm10",
                      data: data.hourly.pm10,
                      borderWidth: 1,
                    },
                    {
                      label: "pm2_5,",
                      data: data.hourly.pm2_5,
                      borderWidth: 1,
                    },
                  ],
                },
                options: {
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            })
            .catch(function (error) {
              console.log(error);
            });
        })
        .catch(function (error) {
          console.log(error);
        });
    </script>
  </body>
</html>
